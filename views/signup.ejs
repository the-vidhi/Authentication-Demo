<html>
    <head>
        <title>Sign Up Page</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
        
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
       
        <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap4.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="../stylesheets/style.css">
    </head>
    <body>  
    <div class="cont container p-5">
        <div class="d1">
            <h3 class="m-3 p-3 text-center">SIGNUP</h3>
            <form method="POST" id="formId" name="formName" class="m-5"> 
                <div class="form-group">
                    <div class="row">
                        <div class="col col-md-4 ">
                            <label class="text-left">First Name</label>
                        </div>
                        <div class="col col-md-8">
                            <input type="text" name="fname" id="fname" class="form-control" maxlength="10" value="<% if(typeof name != 'undefined'){ %><%= name %><% }%>">
                            <span class="error"></span>  
                        </div>
                    </div> 
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col col-md-4 ">
                            <label class="text-left">Last Name</label>
                        </div>
                        <div class="col col-md-8">
                            <input type="text" name="lname" id="lname" class="form-control" maxlength="10" value="<% if(typeof name != 'undefined'){ %><%= name %><% }%>">
                            <span class="error"></span>  
                        </div>
                    </div> 
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col col-md-4">
                            <label class="text-right">Date of Birth</label>
                        </div>
                        <div class="col col-md-8">
                            <input type="date" name="dateofbirth" id="dateofbirth" class="form-control" min="2000-01-01" max="2000-12-31" value="<% if(typeof start != 'undefined'){ %><%= start %><% }%>">
                            <span></span>  
                        </div>
                    </div> 
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col col-md-4">
                            <label class="text-right">Technology</label>
                        </div>
                        <div class="col col-md-8">
                            <input type="text" name="technology" id="technology" class="form-control"maxlength="10" value="<% if(typeof dest != 'undefined'){ %><%= dest %><% }%>">
                            <span></span>  
                        </div>
                    </div> 
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col col-md-4 ">
                            <label class="text-left">Email</label>
                        </div>
                        <div class="col col-md-8">
                            <input type="text" name="email" id="email" class="form-control" maxlength="20" value="<% if(typeof name != 'undefined'){ %><%= name %><% }%>">
                            <span class="error"></span>  
                        </div>
                    </div> 
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col col-md-4 ">
                            <label class="text-left">Password</label>
                        </div>
                        <div class="col col-md-8">
                            <span toggle="#password" class="fa fa-fw fa-eye field-icon toggle-password pass-wrap"></span>
                            <input type="password" name="password" id="password" class="form-control" maxlength="10" value="<% if(typeof name != 'undefined'){ %><%= name %><% }%>">
                            <span class="error"></span>  
                        </div>
                    </div> 
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col col-md-4 ">
                            <label>Signup as Admin ?</label>
                        </div>
                        <div class="col col-md-8">
                            <input type="checkbox" class="" name="isAdmin" id="isAdmin">                            
                        </div>
                    </div> 
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col col-md-4">
                        </div>
                        <div class="col col-md-8">
                            <button type="button" name="insert"id="insert-btn" class="btn btn-insert" style="width: 145px;" onclick="valAddFunc()">Signup</button>
                        </div>
                    </div> 
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col col-12 text-center pt-5 pb-3">
                            Already Signed Up ??    
                        </div>
                        <div class="col col-12 text-center">
                            <input type="button" name="login-btn" id="login-btn" value="Login" class="btn btn-dark" onclick="LoginFunc()" style="width: 145px;"  />
                        </div>
                    </div> 
                </div>
            </form>
        </div>
    </div>      
    </body>
            <div id="msg_modal" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">                             
                            <button type="button" class="close" data-dismiss="modal">&times;</button>                                              
                        </div>
                        <div class="modal-body">
                            <h4 id="val2" style="color: seagreen;">Record Updated...</h4>
                        </div>
                    </div>
                </div>
            </div> 
            <div id="val_msg" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">                             
                            <button type="button" class="close" data-dismiss="modal">&times;</button>                                              
                        </div>
                        <div class="modal-body">
                            <h4 id="val1" style="color: red"></h4>
                        </div>
                    </div>
                </div>
            </div> 

            <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
            <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>

            <script>

            $(".toggle-password").click(function() {

            $(this).toggleClass("fa-eye-slash");
            var input = $($(this).attr("toggle"));
            if (input.attr("type") == "password") {
            input.attr("type", "text");
            } else {
            input.attr("type", "password");
            }
            });

            $(function(){
                var today = new Date();
                var dd = today.getDate();
                var mm = today.getMonth()+1; //January is 0!
                var yyyy = today.getFullYear()-18;
                if(dd<10){
                        dd='0'+dd
                    } 
                    if(mm<10){
                        mm='0'+mm
                    } 

                today = yyyy+'-'+mm+'-'+dd;
                document.getElementById("dateofbirth").setAttribute("max", today);
            });

            function LoginFunc(){
                location.href = '/auth/login'
            }

            function valAddFunc(){

                const formData = $('#formId').serialize();
                $.validator.addMethod("FNameValid", function(value, element){
                    return this.optional(element) || /^[A-Za-z]*$/.test(value);
                }, 'Enter only alphabets...');

                $.validator.addMethod("LNameValid", function(value, element){
                    return this.optional(element) || /^[A-Za-z]*$/.test(value);
                }, 'Enter only alphabets...');

                $.validator.addMethod("TechValid", function(value, element){
                    return this.optional(element) || /^[A-Za-z]*$/.test(value);
                }, 'Enter only alphabets...');

                $.validator.addMethod("EmailValid", function(value, element){
                    return this.optional(element) || /^([\w-\.]+@(gmail+\.)+(com))?$/.test(value);
                }, 'Enter Valid Email Format...');

                $.validator.addMethod("PassValid", function(value, element){
                    return this.optional(element) || /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^&\*])(?=.{8,})/.test(value);
                }, 'Enter Atleast one Capital Letter,Small Letter,Special Characters and Digit...');

                $("#formId").validate({
                rules:{
                    fname: {
                        required: true, 
                        minlength: 3,
                        maxlength: 10,
                        FNameValid: true
                    },
                    lname: {
                        required: true, 
                        minlength: 3,
                        maxlength: 10,
                        LNameValid: true
                    },
                    dateofbirth: {
                        required: true, 
                        // minlength: 3,
                        // maxlength: 10,
                        // DateValid: true
                    },
                    technology: {
                        required: true, 
                        minlength: 3,
                        maxlength: 10,
                        TechValid: true
                    },
                    email: {
                        required: true, 
                        minlength: 3,
                        maxlength: 20,
                        EmailValid: true
                    },
                    password: {
                        required: true, 
                        minlength: 3,
                        maxlength: 10,
                        PassValid: true
                    },
                },
                messages: {

                    fname: {
                        required: "Enter First Name",
                    },
                    lname: {
                        required: "Enter last Name",
                    },
                    dateofbirth: {
                        required: "Select Date of Birth",
                    },
                    technology: {
                        required: "Enter Technology",
                    },
                    email: {
                        required: "Enter Email",
                    },
                    password: {
                        required: "Enter Password",
                    }
                },
                submitHandler: function(form) {
                form.submit();
                },
                errorPlacement: function(label, element) {
                    label.insertAfter(element);
                },
            })
            if($("#formId").valid()){
                console.log($('#formId').serialize());

                let ischeck=$('#isAdmin:checked').length > 0;
                if(ischeck==true){
                    document.getElementById("isAdmin").value = "admin";
                }
                if(ischeck==false){
                    let b = document.getElementById("isAdmin").value = "user"
                    console.log(b,"+++++=");
                }
                // console.log("-------",b);
                // var form = $("#formId");
                    $.ajax({
                        type: "POST",
                        url: '/auth/signup',
                        data: $('#formId').serialize(),
                        success: function(data) {
                            console.log(data);
                            document.getElementById('val2').innerHTML = 'User Sucessfully Added...'
                            $('#msg_modal').modal('show').on('shown.bs.modal', function(f){
                                setTimeout(function(){
                                    location.href = '/auth/login';
                                }, 2000);
                            })
                        },
                        error: function(data) {
                            console.log(data);
                            document.getElementById('val1').innerHTML = data.responseJSON.message;
                            $('#val_msg').modal('show');
                        }
                    });                 
                }
                console.log("valfunc");
            }           
    </script>
     
</html>